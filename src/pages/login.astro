---
import Layout from '../layouts/Layout.astro';

// Si ya está autenticado, redirigir a la página principal
const authToken = Astro.cookies.get('auth-token');
if (authToken) {
	return Astro.redirect('/');
}

const error = Astro.url.searchParams.get('error');
const redirectTo = Astro.url.searchParams.get('redirect') || '/';
---

<Layout 
	title="Iniciar Sesión - Universidad Tomás Frías" 
	description="Accede al sistema de generación de imágenes con IA"
>
	<div class="min-h-[calc(100vh-4rem)] flex items-center justify-center bg-gradient-to-br from-primary-900 via-primary-800 to-secondary-900 py-12 px-4 sm:px-6 lg:px-8">
		<div class="max-w-md w-full space-y-8">
			<!-- Logo y título -->
			<div class="text-center">
				<div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-4">
					<span class="text-primary-800 font-bold text-2xl">AI</span>
				</div>
				<h2 class="text-3xl font-extrabold text-white">
					Iniciar Sesión
				</h2>
				<p class="mt-2 text-sm text-primary-200">
					Accede al sistema de generación de imágenes
				</p>
			</div>

			<!-- Formulario -->
			<div class="bg-white bg-opacity-10 backdrop-blur-lg rounded-lg shadow-xl p-8">
				{error && (
					<div class="mb-4 bg-red-500 bg-opacity-20 border border-red-500 text-white px-4 py-3 rounded-lg">
						<p class="text-sm">
							{error === 'invalid' ? 'Contraseña incorrecta. Por favor, intenta de nuevo.' : 'Debes iniciar sesión para acceder a esta página.'}
						</p>
					</div>
				)}

				<form method="POST" action="/api/auth/login" class="space-y-6" enctype="application/x-www-form-urlencoded">
					<input type="hidden" name="redirect" value={redirectTo} />
					
					<div>
						<label for="password" class="block text-sm font-medium text-white mb-2">
							Contraseña
						</label>
						<input
							id="password"
							name="password"
							type="password"
							required
							class="appearance-none relative block w-full px-3 py-3 border border-primary-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-500 focus:border-transparent focus:z-10 sm:text-sm"
							placeholder="Ingresa la contraseña"
							autofocus
						/>
					</div>

					<div>
						<button
							type="submit"
							class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-secondary-600 hover:bg-secondary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary-500 transition-all duration-200 transform hover:scale-105"
						>
							<span class="absolute left-0 inset-y-0 flex items-center pl-3">
								<svg class="h-5 w-5 text-secondary-300 group-hover:text-secondary-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
									<path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
								</svg>
							</span>
							Iniciar Sesión
						</button>
					</div>
				</form>

				<div class="mt-6">
					<div class="relative">
						<div class="absolute inset-0 flex items-center">
							<div class="w-full border-t border-primary-300"></div>
						</div>
						<div class="relative flex justify-center text-sm">
							<span class="px-2 bg-transparent text-primary-200">
								Acceso restringido solo con contraseña
							</span>
						</div>
					</div>
				</div>
			</div>

			<!-- Link de retorno -->
			<div class="text-center">
				<a href="/" class="text-sm text-primary-200 hover:text-white transition-colors">
					← Volver al inicio
				</a>
			</div>
		</div>
	</div>
</Layout>

<style>
	/* Animación de entrada */
	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(-10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.max-w-md {
		animation: fadeIn 0.5s ease-out;
	}
</style>
